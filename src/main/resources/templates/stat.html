<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>License MGR | BiJie</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="/css/ionicons.min.css">
  <link rel="stylesheet" href="/css/AdminLTE.min.css">
  <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
        page. However, you can choose any other skin. Make sure you
        apply the skin class to the body tag so the changes take effect. -->
  <link rel="stylesheet" href="/css/skins/skin-blue.min.css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

  <!-- Main Header -->
  <header class="main-header">

    <!-- Logo -->
    <a href="#" class="logo">
      <!-- mini logo for sidebar mini 50x50 pixels -->
      <span class="logo-mini"><b>M</b>GR</span>
      <!-- logo for regular state and mobile devices -->
      <span class="logo-lg"><b>License</b> MGR</span>
    </a>
    <!-- Header Navbar -->
    <nav class="navbar navbar-static-top" role="navigation">
      <!-- Sidebar toggle button-->
      <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
        <span class="sr-only">left Toggle navigation</span>
      </a>
      
      <!-- Sidebar toggle button-->
      <a href="#" class="navbar-toggle sidebar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
        <span class="sr-only">right Toggle navigation</span>
      </a>
	  <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
        <ul class="nav navbar-nav">
          <li class="active"><a href="#">首页<span class="sr-only">(current)</span></a></li>
          <li><a href="#">签证管理</a></li>
          <li><a href="#">订票管理</a></li>
          <li><a href="#">业务管理</a></li>
          <li><a href="#">财务管理</a></li>
          <li><a href="#">系统管理</a></li>
          <li><a href="#">内部资料共享</a></li>
        </ul>
      </div>
      <!-- Navbar Right Menu -->
      <div class="navbar-custom-menu">
        <ul class="nav navbar-nav">
          
          <!-- User Account Menu -->
          <li class="dropdown user user-menu">
            <!-- Menu Toggle Button -->
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              <!-- The user image in the navbar-->
              <img src="/img/user2-160x160.jpg" class="user-image" alt="User Image">
              <!-- hidden-xs hides the username on small devices so only the image appears. -->
              <span class="hidden-xs">${Session.ssu.username!}</span>
            </a>
            <ul class="dropdown-menu">
              <!-- The user image in the menu -->
              <li class="user-header">
                <img src="/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                <p>
                  ${Session.ssu.username!}
                  <small>系统管理员</small>
                </p>
              </li>
              <!-- Menu Footer-->
              <li class="user-footer">
                <div class="pull-left">
                  <a href="javascript:goProfile(${Session.ssu.id!})" class="btn btn-default btn-flat">个人信息</a>
                </div>
                <div class="pull-right">
                  <a href="javascript:logout()" class="btn btn-default btn-flat">退出</a>
                </div>
              </li>
            </ul>
          </li>
          <!-- Control Sidebar Toggle Button 
          <li>
            <a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
          </li>
          -->
        </ul>
      </div>
    </nav>
  </header>
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">

    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">

      <!-- Sidebar user panel (optional) -->
      <div class="user-panel">
        <div class="pull-left image">
          <img src="/img/user2-160x160.jpg" class="img-circle" alt="User Image">
        </div>
        <div class="pull-left info">
          <p>${Session.ssu.username!}</p>
          <!-- Status -->
          <a><i class="glyphicon glyphicon-user text-success"></i> 在线</a>
          <a href="javascript:logout()"><i class="glyphicon glyphicon-off text-danger"></i> 退出</a>
        </div>
      </div>

      <!-- Sidebar Menu -->
      <ul class="sidebar-menu" data-widget="tree">
        <li class="header">导航栏</li>
        <!-- Optionally, you can add icons to the links -->
        <li class="active"><a href="/stat"><i class="glyphicon glyphicon-home"></i> <span>首页</span></a></li>
        
        <#if Session.ssu.tMCodes?seq_contains('B00200')>
        <li class="treeview">
          <a href="#"><i class="glyphicon glyphicon-download-alt"></i> <span>注册信息</span>
            <span class="pull-right-container">
                <i class="glyphicon glyphicon-chevron-left fa fa-angle-left pull-right"></i>
              </span>
          </a>
          <ul class="treeview-menu">
            <#if Session.ssu.tMCodes?seq_contains('B00201')><li><a href="/register/list/1">个人用户</a></li></#if>
            <#if Session.ssu.tMCodes?seq_contains('B00202')><li><a href="/register/list/2">企业用户</a></li></#if>
            <#if Session.ssu.tMCodes?seq_contains('B00203')><li><a href="/register/list/3">试用用户</a></li></#if>
            <#if Session.ssu.tMCodes?seq_contains('B00204')><li><a href="/register/log">注册日志</a></li></#if>
          </ul>
        </li>
        </#if>
        
        <#if Session.ssu.tMCodes?seq_contains('B00300')>
        <li class="treeview">
          <a href="#"><i class="glyphicon glyphicon glyphicon-file"></i> <span>授权码管理</span>
            <span class="pull-right-container">
                <i class="glyphicon glyphicon-chevron-left fa fa-angle-left pull-right"></i>
              </span>
          </a>
          <ul class="treeview-menu">
            <#if Session.ssu.tMCodes?seq_contains('B00301')><li><a href="/license/list/1">个人授权</a></li></#if>
            <#if Session.ssu.tMCodes?seq_contains('B00302')><li><a href="/license/list/2">企业授权</a></li></#if>
            <#if Session.ssu.tMCodes?seq_contains('B00303')><li><a href="/license/list/3">试用授权</a></li></#if>
          </ul>
        </li>
        </#if>
        
        <li class="treeview">
          <a href="#"><i class="glyphicon glyphicon-cog"></i> <span>设置</span>
            <span class="pull-right-container">
                <i class="glyphicon glyphicon-chevron-left fa fa-angle-left pull-right"></i>
              </span>
          </a>
          <ul class="treeview-menu">
            <li><a href="/user">用户管理</a></li>
            <li><a href="/system/person">个人授权参数</a></li>
          </ul>
        </li>
      </ul>
      <!-- /.sidebar-menu -->
    </section>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        首页
        <small>概要统计</small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="/stat"><i class="glyphicon glyphicon-home"></i><b>License</b> MGR</a></li>
        <li class="active">首页</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content container-fluid">

      <!--------------------------
        | Your Page Content Here |
        -------------------------->
		<div class="row">
	        <div class="col-lg-3 col-xs-6">
	          <!-- small box -->
	          <div class="small-box bg-teal">
	            <div class="inner">
	              <h3>${count!}</h3>
	              <p>总注册数</p>
	            </div>
	            <div class="icon">
	              <i class="ion ion-cube"></i>
	            </div>
	            <a href="/register/list/1" class="small-box-footer">详细 <i class="glyphicon glyphicon-arrow-right"></i></a>
	          </div>
	        </div>
	        <div class="col-lg-3 col-xs-6">
	          <!-- small box -->
	          <div class="small-box bg-aqua">
	            <div class="inner">
	              <h3>${count1!}</h3>
	              <p>个人注册数(${count1P!}%)</p>
	            </div>
	            <div class="icon">
	              <i class="ion ion-person"></i>
	            </div>
	            <a href="/register/list/1" class="small-box-footer">详细 <i class="glyphicon glyphicon-arrow-right"></i></a>
	          </div>
	        </div>
	        <!-- ./col -->
	        <div class="col-lg-3 col-xs-6">
	          <!-- small box -->
	          <div class="small-box bg-green">
	            <div class="inner">
	              <h3>${count2!}</h3>
	              <p>企业注册数(${count2P!}%)</p>
	            </div>
	            <div class="icon">
	              <i class="ion ion-android-desktop"></i>
	            </div>
	            <a href="/register/list/2" class="small-box-footer">详细 <i class="glyphicon glyphicon-arrow-right"></i></a>
	          </div>
	        </div>
	        <!-- ./col -->
	        <div class="col-lg-3 col-xs-6">
	          <!-- small box -->
	          <div class="small-box bg-yellow">
	            <div class="inner">
	              <h3>${count3!}</h3>
	              <p>试用注册数(${count3P!}%)</p>
	            </div>
	            <div class="icon">
	              <i class="ion ion-erlenmeyer-flask"></i>
	            </div>
	            <a href="/register/list/3" class="small-box-footer">详细 <i class="glyphicon glyphicon-arrow-right"></i></a>
	          </div>
	        </div>
	        <!-- ./col -->
      </div>
      <!-- /.row -->
      
      <div class="row">
	    <div class="col-md-12">
          <div class="box">
            <div class="box-body">
            
              <div class="row">
                <div class="col-md-7">
           		    <div class="box box-primary">
			            <div class="box-body" id="mapDiv" style="height: 460px">正在加载地图数据...请耐心等待（IE9及以下浏览器不支持）。</div>
			        </div>
                </div>
                
                <div class="col-md-5">
           		    <div class="box box-primary">
			            <div class="box-header with-border">
			                <div class="btn-group">
			                  <button id="btn_1" onclick="changeTab(1)" class="btn btn-default active">近期走势</button>
			                  <button id="btn_2" onclick="changeTab(2)" class="btn btn-default">省份统计</button>
			                  <button id="btn_3" onclick="changeTab(3)" class="btn btn-default">详细信息</button>
			                </div>
			            </div>
			            <!-- /.box-header -->
			            <div id="tab_1">
			            	<div class="box-body" id="barDiv" style="height: 405px">正在加载数据...请耐心等待。</div>
			            </div>
			            <div id="tab_2" style="display: none">
			            	<div class="box-body" id="pieDiv" style="height: 405px">正在加载数据...请耐心等待。</div>
			            </div>
			          	<!-- /.tab1 -->
			            <div id="tab_3" style="display: none">
				            <div class="box-body" style="min-height: 350px">
				              <table class="table table-bordered">
				                <tr>
				                  <th>#IP</th>
				                  <th>类型</th>
				                  <th>城市</th>
				                  <th>注册日期</th>
				                </tr>
	                			<#list tRegisterLogs as p>
				                <tr>
	                  			  <td>${p.ip!}</td>
	                              <td><#if p.userType == 1>个人<#elseif p.userType == 2>企业<#elseif p.userType == 3>试用<#else>${p.userType!}</#if></td>
	                  			  <td>${p.city!}</td>
	                  			  <td>${p.createTime?string("yyyy-MM-dd HH:mm:ss")}</td>
				                </tr>
	                			</#list>
				              </table>
				            </div>
				            <!-- /.box-body -->
				            <div class="box-footer clearfix">
				            	<#if pagination??>
					              <ul class="pagination pagination-sm no-margin pull-right">
					            	<#if pagination.hasPreviousPage>
					                	<li><a href="${pagination.previousPageUri}">&laquo;</a></li>
						          	<#else>
					                	<li><a>&laquo;</a></li>
					            	</#if>
				            		<#if pagination.pageList??>
				                	<#list pagination.pageList as p>
						            	<#if p.isCurrent>
							                <li class="active"><a>${p.pageNo}</a></li>
						            	<#else>
							                <li><a href="${p.pageUri}">${p.pageNo}</a></li>
						            	</#if>
						            </#list>
					            	</#if>
					            	<#if pagination.hasNextPage>
					                	<li><a href="${pagination.nextPageUri}">&raquo;</a></li>
						          	<#else>
					                	<li><a>&raquo;</a></li>
					            	</#if>
					              </ul>
				            	</#if>
				            </div>
				          	<!-- /.box-footer -->
			          	</div>
			          	<!-- /.tab2 -->
			        </div>
			        <!-- /.box -->
                </div>
                
              </div>
             </div>
          
	        </div>
      	  </div>
      	
      	</div>
      <!-- /.row -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Main Footer -->
  <footer class="main-footer">
    <!-- To the right -->
    <div class="pull-right hidden-xs">
      Anything you want
    </div>
    <!-- Default to the left -->
    <strong>Copyright &copy; 2018 <a target="_blank" href="https://www.bijienetworks.com/">bijienetworks.com</a>.</strong> All rights reserved.
  </footer>

  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<!-- REQUIRED JS SCRIPTS -->

<!-- jQuery 3 -->
<script src="/js/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="/js/bootstrap.min.js"></script>
<!-- AdminLTE App -->
<script src="/js/adminlte.min.js"></script>
<script src="/js/common.js"></script>
<!-- eChart -->
<script type="text/javascript" src="/js/echart/echarts.all.min.js"></script>
<script type="text/javascript" src="/js/echart/china.js"></script>
<script type="text/javascript" src="/js/echart/world.js"></script>
<script type="text/javascript" src="/js/echart/api.js"></script>
<script type="text/javascript" src="/js/echart/bmap.min.js"></script>
<script type="text/javascript" src="/js/echart/macarons.js"></script>
<script>

//近期趋势
var barDom = document.getElementById("barDiv");
var barChart = echarts.init(barDom, "macarons");
var barDataX = [${barDataX!}];
var barDataY1 = [${barDataY1!}];
var barDataY2 = [${barDataY2!}];
var barOption = {
	    title : {
	        text: '近期注册走势',
	        subtext: '最近半年数据'
	    },
	    tooltip : {
	        trigger: 'axis'
	    },
	    legend: {
	        data:['设备数','注册数']
	    },
	    toolbox: {
	        show : true,
	        feature : {
	            mark : {show: true},
	            dataView : {show: true, readOnly: false},
	            magicType : {show: true, type: ['line', 'bar']},
	            restore : {show: true},
	            saveAsImage : {show: true}
	        }
	    },
	    calculable : true,
	    xAxis : [
	        {
	            type : 'category',
	            data : barDataX
	        }
	    ],
	    yAxis : [
	        {
	            type : 'value'
	        }
	    ],
	    series : [
	        {
	            name:'设备数',
	            type:'line',
	            data:barDataY1, 
	            markPoint : {
	                data : [
	                    {type : 'max', name: '最大值'},
	                    {type : 'min', name: '最小值'}
	                ]
	            },
	            markLine : {
	                data : [
	                    {type : 'average', name: '平均值'}
	                ]
	            }
	        },
	        {
	            name:'注册数',
	            type:'line',
	            data:barDataY2,
	            markPoint : {
	                data : [
	                    {type : 'max', name: '最大值'},
	                    {type : 'min', name: '最小值'}
	                ]
	            },
	            markLine : {
	                data : [
	                    {type : 'average', name : '平均值'}
	                ]
	            }
	        }
	    ]
	};
barChart.setOption(barOption, true);

//省份占比
var pieDom = document.getElementById("pieDiv");
var pieChart = echarts.init(pieDom, "macarons");
var pieData = [${pieData!}];
var convertData = function (data) {
    var res = [];
    for (var i = 0; i < data.length; i++) {
    	res.push(data[i].name);
    }
    return res;
};
var pieOption = {
	    title : {
	        text: '省份占比',
	        subtext: '全部数据',
	        x:'left'
	    },
	    tooltip : {
	        trigger: 'item',
	        formatter: "{a} <br/>{b} : {c} ({d}%)"
	    },
	    legend: {
	        orient : 'horizontal',
	        x : 'left',
	        y : 'bottom',
	        data:convertData(pieData)
	    },
	    toolbox: {
	        show : true,
	        feature : {
	            mark : {show: true},
	            dataView : {show: true, readOnly: false},
	            magicType : {
	                show: true, 
	                type: ['pie', 'funnel'],
	                option: {
	                    funnel: {
	                        x: '25%',
	                        width: '50%',
	                        funnelAlign: 'left',
	                        max: 1548
	                    }
	                }
	            },
	            restore : {show: true},
	            saveAsImage : {show: true}
	        }
	    },
	    calculable : true,
	    series : [
	        {
	            name:'注册来源',
	            type:'pie',
	            radius : '45%',
	            center: ['50%', '42%'],
	            data:pieData
	        }
	    ]
	};
pieChart.setOption(pieOption, true);


//地图分布
var mapDom = document.getElementById("mapDiv");
var mapChart = echarts.init(mapDom, "macarons");
var mapData = [${mapData!}];
var mapOption = {
    title: {
        text: '来源区域分布地图',
        subtext: 'data from bijienetworks.com',
        sublink: 'http://www.bijienetworks.com',
        left: 'center'
    },
    tooltip: {
        trigger: 'item',
        formatter: function (params) {
            return params.name + ":" +params.value[2];//自行定义formatter格式
        }
    },
    bmap: {
        center: [104.114129, 37.550339],
        zoom: 4,
        roam: true,
        mapStyle: {
            styleJson: [{
                'featureType': 'water',
                'elementType': 'all',
                'stylers': {
                    'color': '#d1d1d1'
                }
            }, {
                'featureType': 'land',
                'elementType': 'all',
                'stylers': {
                    'color': '#f3f3f3'
                }
            }, {
                'featureType': 'railway',
                'elementType': 'all',
                'stylers': {
                    'visibility': 'off'
                }
            }, {
                'featureType': 'highway',
                'elementType': 'all',
                'stylers': {
                    'color': '#fdfdfd'
                }
            }, {
                'featureType': 'highway',
                'elementType': 'labels',
                'stylers': {
                    'visibility': 'off'
                }
            }, {
                'featureType': 'arterial',
                'elementType': 'geometry',
                'stylers': {
                    'color': '#fefefe'
                }
            }, {
                'featureType': 'arterial',
                'elementType': 'geometry.fill',
                'stylers': {
                    'color': '#fefefe'
                }
            }, {
                'featureType': 'poi',
                'elementType': 'all',
                'stylers': {
                    'visibility': 'off'
                }
            }, {
                'featureType': 'green',
                'elementType': 'all',
                'stylers': {
                    'visibility': 'off'
                }
            }, {
                'featureType': 'subway',
                'elementType': 'all',
                'stylers': {
                    'visibility': 'off'
                }
            }, {
                'featureType': 'manmade',
                'elementType': 'all',
                'stylers': {
                    'color': '#d1d1d1'
                }
            }, {
                'featureType': 'local',
                'elementType': 'all',
                'stylers': {
                    'color': '#d1d1d1'
                }
            }, {
                'featureType': 'arterial',
                'elementType': 'labels',
                'stylers': {
                    'visibility': 'off'
                }
            }, {
                'featureType': 'boundary',
                'elementType': 'all',
                'stylers': {
                    'color': '#fefefe'
                }
            }, {
                'featureType': 'building',
                'elementType': 'all',
                'stylers': {
                    'color': '#d1d1d1'
                }
            }, {
                'featureType': 'label',
                'elementType': 'labels.text.fill',
                'stylers': {
                    'color': '#999999'
                }
            }]
        }
    },
    series : [
        {
            name: '散点',
            type: 'scatter',
            coordinateSystem: 'bmap',
            data: mapData,
            symbolSize: function (val) {
                return val[2]/2;
            },
            label: {
                normal: {
                    formatter: '{b}',
                    position: 'right',
                    show: false
                },
                emphasis: {
                    show: true
                }
            },
            itemStyle: {
                normal: {
                    color: 'purple'
                }
            }
        },
        {
            name: 'Top 5',
            type: 'effectScatter',
            coordinateSystem: 'bmap',
            data: mapData,
            symbolSize: function (val) {
                return val[2] / 2;
            },
            showEffectOn: 'render',
            rippleEffect: {
                brushType: 'stroke'
            },
            hoverAnimation: true,
            label: {
                normal: {
                    formatter: '{b}',
                    position: 'right',
                    show: true
                }
            },
            itemStyle: {
                normal: {
                    color: 'purple',
                    shadowBlur: 10,
                    shadowColor: '#333'
                }
            },
            zlevel: 1
        }
    ]
};
mapChart.setOption(mapOption, true);

window.addEventListener("resize", function () {
	if($("#barDiv").parent().is(":visible")){barChart.resize()};
	mapChart.resize();
});

function changeTab(index){
	for(var i=1; i<=3; i++){
		if(i == index){
			$('#tab_'+i).show();
			$('#btn_'+i).addClass("active");
			if(i == 1){
				barChart.resize();
			}
			if(i == 2){
				pieChart.resize();
			}
		}else{
			$('#tab_'+i).hide();
			$('#btn_'+i).removeClass("active");
		}
	}
}
$(function(){
	var tab = ${tab!};
	if(tab > 1){
		changeTab(tab);
	}
})
</script>
<!-- Optionally, you can add Slimscroll and FastClick plugins.
     Both of these plugins are recommended to enhance the
     user experience. -->
</body>
</html>